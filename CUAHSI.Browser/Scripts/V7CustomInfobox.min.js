var CustomInfobox = function (a, n) { var c = a, g, l, e, d; var m = { arrowColor: "#fff", arrowLength: 20, arrowWidth: 30, borderColor: "#000", color: "#fff", minHeight: 50, minWidth: 100, offset: { x: 0, y: 0 }, orientation: 0, showArrow: true, showCloseButton: true, tether: false }; function i() { e = a.getRootElement().parentNode.id + "_infobox"; $("body").append("<div id='" + e + "' style='position:absolute;z-index:10000;display:none;'></div>"); f(m.tether); k(n) } function j(q) { var p = ["<div id='", e, "_arrow' style='position:relative;float:left;width:0;height:0;line-height:0;border-style:solid;"]; var o = m.arrowWidth * 0.5; switch (q) { case 0: p.push("border-width:0 ", o, "px ", m.arrowLength, "px ", o, "px;"); p.push("border-color:transparent transparent ", m.arrowColor, " transparent;"); break; case 1: p.push("border-width:", o, "px 0 ", o, "px ", m.arrowLength, "px;"); p.push("border-color:transparent transparent transparent ", m.arrowColor, ";"); break; case 2: p.push("border-width:", m.arrowLength, "px ", o, "px 0 ", o, "px;"); p.push("border-color:", m.arrowColor, " transparent transparent transparent;"); break; case 3: p.push("border-width:", o, "px ", m.arrowLength, "px ", o, "px 0;"); p.push("border-color:transparent ", m.arrowColor, " transparent transparent;"); break } p.push("'></div>"); return p.join("") } function f(o) { if (d != null) { Microsoft.Maps.Events.removeHandler(d) } if (o) { d = Microsoft.Maps.Events.addThrottledHandler(c, "viewchange", h, 40) } else { d = Microsoft.Maps.Events.addHandler(c, "viewchangestart", b) } } function b() { l = null; g = null; h() } function h() { var p = $("#" + e); if (p != null && l != null && g != null) { if (!c.getBounds().contains(l)) { p.css("display", "none") } else { p.css("display", ""); var x = c.tryLocationToPixel(l, Microsoft.Maps.PixelReference.control), s = c.getPageX() + x.x, q = c.getPageY() + x.y; var E = (c.getHeight() * 0.5 < x.y) ? 2 : 0; E += (c.getWidth() * 0.5 < x.x) ? 1 : 0; var r = ["<div id='", e, "_content' style='position:relative;float:left;border:1px solid ", m.borderColor, ";background-color:", m.color, ";min-width:", m.minWidth, "px;min-height:", m.minHeight, "px;'>", g, "</div>"]; var o = 0, F = 0, z; if (m.showArrow) { if (m.orientation) { o = m.arrowWidth; F = m.arrowLength; if (E > 1) { z = r.join("") + j(2) } else { z = j(0) + r.join("") } } else { o = m.arrowLength; F = m.arrowWidth; if (E % 2) { z = r.join("") + j(1) } else { z = j(3) + r.join("") } } } else { z = r.join("") } p.html(z); var B = $("#" + e + "_content"); if (m.showCloseButton) { B.append("<span id='" + e + "_closeBtn' href='javascript:void()' style='position:absolute;right:5px;top:2px;cursor:pointer;font:bold 18px Arial;line-height:12px;'>x</span>"); $("#" + e + "_closeBtn").click(function () { b() }) } var v = B.outerWidth(), u = B.outerHeight(); var D = 0, y = 0, t = 0, A = 0; if (m.orientation) { D = v; y = u + F; if (E % 2) { A = D - m.arrowWidth; s += m.offset.x - D + m.arrowWidth * 0.5 } else { s += m.offset.x - m.arrowWidth * 0.5 } if (E > 1) { q -= y + m.offset.y } else { q -= m.offset.y } } else { D = o + v; y = Math.max(u, F); if (E % 2) { s += m.offset.x - D } else { s += m.offset.x } if (E > 1) { t = y - m.arrowWidth; q -= y - m.arrowWidth * 0.5 + m.offset.y } else { q -= (m.arrowWidth * 0.5 + m.offset.y) } } if (m.showArrow) { var C = $("#" + e + "_arrow"); C.css({ "margin-left": Math.ceil(A) + "px", "margin-top": Math.ceil(t) + "px" }) } p.css({ width: Math.ceil(D) + "px", height: Math.ceil(y) + "px", top: q, left: s }) } } else { if (p != null) { p.html(""); p.css("display", "none") } } } function k(p) { var o = m.tether; for (attrname in p) { m[attrname] = p[attrname] } if (o != m.tether) { f(m.tether) } h() } this.hide = function () { b() }; this.show = function (o, p) { l = o; g = p; h() }; this.getOptions = function () { return m }; this.setOptions = function (o) { k(o) }; i() }; Microsoft.Maps.moduleLoaded("CustomInfoboxModule");